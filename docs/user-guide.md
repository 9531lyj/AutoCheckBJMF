# 📚 AutoCheckBJMF 增强版用户指南

本指南将详细介绍如何使用 AutoCheckBJMF 增强版的各项功能。

## 🚀 快速上手

### 第一次使用

1. **启动程序**
   ```bash
   python main_enhanced.py
   ```

2. **选择配置方式**
   
   程序启动后会显示配置选择对话框：
   
   ```
   ┌─────────────────────────────────────┐
   │            配置选择                  │
   ├─────────────────────────────────────┤
   │  选择配置方式：                      │
   │                                     │
   │  是   - 快速自动配置（推荐）         │
   │  否   - 详细配置向导                 │
   │  取消 - 退出程序                     │
   └─────────────────────────────────────┘
   ```

3. **推荐选择"快速自动配置"**
   
   这是最简单的方式，程序会自动完成所有配置。

## 🎯 快速自动配置

### 配置流程

快速配置大约需要 3-5 分钟，包含以下步骤：

#### 步骤 1: Cookie 自动提取
```
🔍 正在从浏览器提取Cookie...
✅ 从 chrome 提取到 1 个相关Cookie
✅ 从 edge 提取到 1 个相关Cookie
✅ 总共提取到 2 个Cookie
```

**如果提取失败**：
- 确保已在浏览器中登录班级魔方网站
- 尝试重新登录后再次运行程序
- 选择"详细配置向导"手动输入

#### 步骤 2: 班级信息检测
```
🏫 正在检测班级信息...
✅ 检测到 3 个班级
📝 其中 2 个班级支持签到功能
🎯 自动选择班级: 软件工程2023-1班 (ID: 12345)
```

**如果检测到多个班级**：
- 程序会显示班级选择界面
- 选择需要签到的班级
- 支持多选（为不同班级配置不同时间）

#### 步骤 3: 位置信息获取
```
📍 正在获取位置信息...
✅ IP定位成功: IP定位
📍 位置: 北京, 北京市
```

**位置确认对话框**：
```
┌─────────────────────────────────────┐
│            位置确认                  │
├─────────────────────────────────────┤
│  检测到您的大概位置：                │
│  城市: 北京                         │
│  地区: 北京市                       │
│  坐标: 39.904697, 116.407178        │
│                                     │
│  是否使用此位置？                    │
│  （选择'否'将打开手动选择）          │
└─────────────────────────────────────┘
```

#### 步骤 4: 配置完成
```
🎉 快速设置完成！
✅ 配置已保存到安全存储
🚀 程序启动成功！
```

## 🧙‍♂️ 详细配置向导

如果选择详细配置向导，程序会逐步引导您完成每个配置项。

### 向导界面

```
┌─────────────────────────────────────────────────────────────┐
│  AutoCheckBJMF 配置向导                                      │
├─────────────────────────────────────────────────────────────┤
│  步骤 1/6: 欢迎                                             │
│  ████████████████████████████████████████████████████ 16%   │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  欢迎使用 AutoCheckBJMF 自动签到工具！                       │
│                                                             │
│  本向导将帮助您完成初始配置，包括：                          │
│                                                             │
│  • 📍 自动获取GPS位置信息                                    │
│  • 🍪 自动提取或配置Cookie                                   │
│  • 🏫 自动检测班级信息                                       │
│  • ⏰ 设置定时签到任务                                       │
│                                                             │
│  整个过程大约需要3-5分钟。                                   │
│                                                             │
│                                                             │
├─────────────────────────────────────────────────────────────┤
│  [上一步]                                    [取消] [下一步] │
└─────────────────────────────────────────────────────────────┘
```

### 各步骤详解

#### 步骤 2: 位置配置
- **自动定位**: 基于IP地址获取大概位置
- **手动调整**: 可以精确输入坐标
- **地图选择**: 打开腾讯地图选择精确位置

#### 步骤 3: Cookie配置
- **浏览器提取**: 从已登录的浏览器自动获取
- **自动登录**: 输入用户名密码自动登录获取
- **手动输入**: 手动复制粘贴Cookie

#### 步骤 4: 班级选择
- **自动检测**: 从Cookie中提取班级列表
- **搜索功能**: 通过关键词搜索班级
- **手动输入**: 直接输入班级ID

#### 步骤 5: 定时设置
- **手动模式**: 立即执行签到
- **定时模式**: 设置每日自动签到时间
- **推送通知**: 配置签到结果推送

#### 步骤 6: 完成配置
- **配置摘要**: 显示所有配置信息
- **保存配置**: 自动保存到安全存储
- **开始使用**: 立即开始签到

## 📱 程序运行模式

### 手动签到模式

```bash
🚀 手动签到模式，立即执行
🚀 开始执行签到任务，当前时间: 2024-01-15 14:30:25

🔄 用户UID: 1 <张三> 正在签到...
📍 找到签到任务: GPS(1) 扫码(0)
✅ 签到结果: 签到成功

📊 签到统计: 成功 1/1
🎉 本次签到圆满成功！

✅ 手动签到已完成，按回车键退出...
```

### 定时签到模式

```bash
⏰ 定时签到模式，设定时间: 08:30
⏳ 等待定时时间到达...

当前时间：2024-01-15 23:45，距离下次任务执行8:30 还剩8小时45分钟

# 到达设定时间后自动执行签到
🚀 开始执行签到任务，当前时间: 2024-01-16 08:30:00
...
☆本次签到结束，等待设定的时间08:30到达☆
```

## 🔧 高级功能

### 多用户管理

程序支持同时管理多个用户的Cookie：

```json
{
  "cookies": [
    "username=张三;remember_student_xxx=cookie1",
    "username=李四;remember_student_xxx=cookie2",
    "username=王五;remember_student_xxx=cookie3"
  ]
}
```

**批量签到流程**：
```
☆☆☆☆☆ 用户UID：1 <张三> 即将签到 ☆☆☆☆☆
★★★★★ 用户UID：1 <张三> 开始签到 ★★★★★
✅ 签到结果: 签到成功

☆☆☆☆☆ 用户UID：2 <李四> 即将签到 ☆☆☆☆☆
★★★★★ 用户UID：2 <李四> 开始签到 ★★★★★
✅ 签到结果: 签到成功
```

### 智能重试机制

当签到失败时，程序会自动重试：

```
❌ 检测到 1 个Cookie签到失败，5分钟后重试...
🔄 开始第 1 次重试...
✅ 重试成功

# 如果仍然失败
❌ 检测到仍然有Cookie签到失败，15分钟后最后重试...
🔄 开始第 2 次重试...
```

### 推送通知

配置PushPlus Token后，可以接收签到结果推送：

```json
{
  "pushplus": "your_pushplus_token"
}
```

**推送内容示例**：
```
标题: 班级魔法自动签到任务
内容: 签到成功
时间: 2024-01-16 08:30:15
```

## 📊 状态监控

### 实时日志

程序运行时会生成详细的日志文件：

```bash
# 查看实时日志
tail -f AutoCheckBJMF_enhanced.log

# 日志内容示例
2024-01-16 08:30:00 - INFO - 开始执行签到任务
2024-01-16 08:30:01 - INFO - 用户UID[1] <张三> | 签到请求已发送
2024-01-16 08:30:02 - INFO - 用户UID[1] <张三> | 签到成功
2024-01-16 08:30:03 - INFO - 签到任务完成，全部成功
```

### 配置信息查看

程序启动时会显示当前配置：

```
============================== 配置信息 ==============================
班级ID: 12345
纬度: 39.90469700
经度: 116.40717800
海拔: 100
Cookie数量: 2
定时: 08:30
通知token: your_token
======================================================================
```

## 🔄 配置管理

### 重新配置

如果需要修改配置，可以：

1. **删除配置文件**重新开始：
   ```bash
   rm config.json
   python main_enhanced.py
   ```

2. **清除安全存储**：
   ```bash
   python -c "from modules.secure_storage import CookieManager; CookieManager().clear_all_data()"
   ```

3. **运行配置向导**：
   ```bash
   # Windows
   配置AutoCheckBJMF.bat
   
   # Linux/macOS
   ./config_autocheckbjmf.sh
   ```

### 配置备份

重要配置会自动保存到安全存储，同时也会生成传统的JSON配置文件：

```json
{
    "class": "12345",
    "lat": "39.90469700",
    "lng": "116.40717800",
    "acc": "100",
    "cookie": ["username=张三;remember_student_xxx=..."],
    "scheduletime": "08:30",
    "pushplus": "your_token",
    "debug": false,
    "configLock": true
}
```

## 🛡️ 安全特性

### 数据加密

- **本地存储**: 所有敏感数据都经过加密存储
- **跨平台**: 使用各平台的安全存储机制
- **密钥管理**: 基于机器特征生成唯一密钥

### 隐私保护

- **无云端传输**: 所有数据仅存储在本地
- **最小权限**: 仅请求必要的系统权限
- **数据清理**: 支持一键清除所有数据

## 📞 获取帮助

### 内置帮助

```bash
# 查看帮助信息
python main_enhanced.py --help

# 运行诊断
python main_enhanced.py --diagnose

# 启用调试模式
python main_enhanced.py --debug
```

### 在线资源

- 📖 [完整文档](https://9531lyj.github.io/AutoCheckBJMF/)
- 🐛 [问题反馈](https://github.com/JasonYANG170/AutoCheckBJMF/issues)
- 💬 [讨论区](https://github.com/JasonYANG170/AutoCheckBJMF/discussions)

---

**下一步**: [配置指南](configuration-guide.md) | [故障排除](troubleshooting.md) | [开发文档](developer-guide.md)
